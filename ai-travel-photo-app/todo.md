# AI 旅拍换脸小程序 - 项目TODO

## 核心功能

### 用户认证系统
- [x] 用户登录/注册（OAuth集成）
- [x] 用户积分管理
- [x] 新用户赠送积分
- [x] 用户信息管理（脸型、性别、人群类型）

### 模板管理
- [x] 模板数据库表设计
- [x] 城市/景点/人群分类
- [x] 单人/合照模板支持
- [x] 脸型适配（宽脸/窄脸）
- [x] 模板遮盖区域配置
- [x] 模板统计（曝光数、选择数、购买数）

### AI换脸功能
- [x] Coze API集成
- [x] 单人照换脸
- [x] 合照换脸
- [x] 遮盖区域保护背景
- [x] 人脸分析（脸型、性别、人群类型检测）

### 订单系统
- [x] 订单创建和管理
- [x] 积分消费记录
- [x] 订单状态追踪
- [ ] 支付集成（需配置微信/抖音支付）

### 用户照片管理
- [x] 自拍照上传
- [x] 生成结果展示
- [x] 照片分享功能
- [x] 历史记录查看

### 渠道推广系统
- [x] 渠道管理
- [x] 推广码生成
- [x] 销售人员管理
- [x] 佣金结算

### 管理后台
- [x] 模板管理界面
- [x] 用户管理界面
- [x] 订单统计
- [x] 渠道数据分析

### 基础设施
- [x] S3文件存储集成
- [x] 腾讯地图API集成
- [x] 二维码生成
- [x] 短信服务

## 前端页面

### 用户端
- [x] 首页（模板选择）
- [x] 模板详情页
- [x] 拍照/上传页
- [x] 生成结果页
- [x] 个人中心
- [x] 积分记录
- [x] 历史照片

### 管理端
- [x] 管理后台首页
- [x] 模板管理
- [x] 用户管理
- [x] 订单管理
- [x] 渠道管理
- [x] 数据统计

## 已完成

## Bug修复

- [x] 修复数据库表查询错误（templates和groupTypes表）- 已插入默认人群类型数据
- [x] 修复数据库查询持续失败问题 - 已重启服务并确认数据库连接正常
- [x] 修复TemplateDetail组件URL构造错误 - 服务已正常运行
- [ ] 修复模板不存在错误（API返回undefined问题）
- [x] 配置腾讯位置服务API密钥 - 已配置并通过测试

## API配置管理功能开发

- [x] 扩展数据库schema添加systemConfigs表
- [x] 创建后端API路由（获取/更新/测试配置）
- [x] 创建前端API配置页面（/admin/settings/api-config）
- [x] 修改Coze集成代码支持从数据库读取配置
- [x] 添加配置测试功能

## 导航结构调整

- [x] 从左侧导航栏移除"API配置"和"修改密码"
- [x] 在头像弹窗菜单中添加"API配置"入口

## API配置页面修复

- [x] 修复工作流ID验证逻辑（显示错误的红色X）- 验证逻辑正确，需要先配置Coze API Key
- [x] 简化说明文字（移除输入参数说明）

## 人群类型排序功能修复

- [x] 修复排序冲突问题（当修改排序值与现有排序冲突时自动调整其他项的排序）

## 合照类型数据修复

- [x] 检查并修复合照类型数据丢失问题（12种合照类型）
- [x] 更新合照类型显示名称为用户要求的格式

## 背景遮盖功能修复和UI重设计

- [ ] 查找背景遮盖功能无法真实遮盖背景人物的原因
- [ ] 制定修复方案（确保AI换脸不会处理遮盖区域）
- [ ] 重新设计UI界面为全屏模式（左侧图片列表+右侧大画布）
- [ ] 实现修复和UI更新
- [ ] 测试背景遮盖功能是否有效

## Coze工作流调用参数错误修复

- [x] 查找Coze工作流调用中的参数格式错误（template_image_url应为字符串，不是数组）
- [x] 修复Invalid request parameters错误
- [x] 测试修复是否有效（所有测试用例全部通过）
